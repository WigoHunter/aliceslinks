<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>正在開啟 YouTube...</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
      color: white;
      padding: 20px;
    }
    .container {
      text-align: center;
      max-width: 400px;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 24px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    h1 {
      font-size: 24px;
      margin-bottom: 12px;
    }
    p {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 24px;
    }
    .btn {
      display: inline-block;
      background: white;
      color: #cc0000;
      padding: 14px 28px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .fallback {
      margin-top: 16px;
      font-size: 14px;
      opacity: 0.8;
    }
    .fallback a {
      color: white;
    }
    .error {
      background: rgba(0,0,0,0.2);
      padding: 20px;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <div class="container" id="content">
    <div class="spinner"></div>
    <h1>正在開啟 YouTube App...</h1>
    <p>如果沒有自動開啟，請點擊下方按鈕</p>
    <a href="#" class="btn" id="openBtn">開啟 YouTube</a>
    <p class="fallback">
      或 <a href="#" id="webLink">在網頁版觀看</a>
    </p>
  </div>

  <script>
    (function() {
      // 從 URL 取得 video ID
      const params = new URLSearchParams(window.location.search);
      const videoId = params.get('v');
      
      // 如果沒有 video ID，顯示錯誤
      if (!videoId) {
        document.getElementById('content').innerHTML = `
          <div class="error">
            <h1>❌ 缺少影片 ID</h1>
            <p>請使用正確的連結格式：<br><code>?v=影片ID</code></p>
          </div>
        `;
        return;
      }

      // 各種 URL
      const webUrl = `https://www.youtube.com/watch?v=${videoId}`;
      const youtubeScheme = `youtube://www.youtube.com/watch?v=${videoId}`;
      const vndUrl = `vnd.youtube://www.youtube.com/watch?v=${videoId}`;
      
      // Android Intent URL (更可靠)
      const intentUrl = `intent://www.youtube.com/watch?v=${videoId}#Intent;package=com.google.android.youtube;scheme=https;end`;

      // 偵測平台
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
      const isAndroid = /android/i.test(ua);

      // 設定按鈕連結
      const openBtn = document.getElementById('openBtn');
      const webLink = document.getElementById('webLink');
      
      webLink.href = webUrl;

      // 選擇適合的 deep link
      let deepLink;
      if (isIOS) {
        deepLink = vndUrl; // iOS 用 vnd.youtube scheme 比較可靠
      } else if (isAndroid) {
        deepLink = intentUrl;
      } else {
        // Desktop 直接去網頁版
        window.location.href = webUrl;
        return;
      }

      openBtn.href = deepLink;

      // 自動嘗試開啟 app
      function tryOpenApp() {
        const start = Date.now();
        
        // 設定 timeout，如果 2.5 秒後還在這頁面，fallback 到網頁版
        const timeout = setTimeout(function() {
          // 如果頁面還在 visible，表示 app 沒開成功
          if (!document.hidden && Date.now() - start > 2000) {
            // 不自動 redirect，讓用戶自己選擇
          }
        }, 2500);

        // 當頁面被隱藏（app 開啟成功），清除 timeout
        document.addEventListener('visibilitychange', function() {
          if (document.hidden) {
            clearTimeout(timeout);
          }
        });

        // 嘗試開啟
        if (isIOS) {
          // iOS: 先試 universal link，再試 custom scheme
          window.location.href = deepLink;
        } else if (isAndroid) {
          // Android: 用 intent URL
          window.location.href = deepLink;
        }
      }

      // 頁面載入後稍等一下再嘗試
      setTimeout(tryOpenApp, 300);
    })();
  </script>
</body>
</html>
